<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>卡通黑白棋 (Cartoon Reversi)</title>
  <style>
    body { font-family: sans-serif; text-align: center; }
    #board { display: grid; grid-template-columns: repeat(8, 50px); width: 400px; margin: auto; }
    .cell {
      width: 50px; height: 50px; border: 1px solid #333;
      display: flex; align-items: center; justify-content: center;
      background-color: green;
    }
    .black img, .white img {
      width: 40px; height: 40px; border-radius: 50%;
    }
  </style>
</head>
<body>
  <h1>卡通黑白棋</h1>
  <div id="board"></div>
  <p>目前輪到：<span id="currentPlayer">玩家</span></p>
  <script>
    const board = document.getElementById('board');
    const status = document.getElementById('currentPlayer');
    let currentPlayer = 'black';
    let cells = Array(8).fill(null).map(() => Array(8).fill(null));
    const aiEnabled = true;
    const aiPlayer = 'white';

    const imgMap = {
      //black: 'https://cdn-icons-png.flaticon.com/512/616/616408.png', // 小羊咪咩
      black: './sheep.png', // 小羊咪咩
      white: './chicken.png'  // 小雞
    };

    function createBoard() {
      board.innerHTML = '';
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.x = x;
          cell.dataset.y = y;
          board.appendChild(cell);
        }
      }
      initPieces();
      drawBoard();
    }

    function initPieces() {
      cells[3][3] = 'white';
      cells[3][4] = 'black';
      cells[4][3] = 'black';
      cells[4][4] = 'white';
    }

    function drawBoard() {
      document.querySelectorAll('.cell').forEach(cell => {
        const x = +cell.dataset.x;
        const y = +cell.dataset.y;
        cell.innerHTML = '';
        if (cells[y][x]) {
          const img = document.createElement('img');
          img.src = imgMap[cells[y][x]];
          const wrapper = document.createElement('div');
          wrapper.className = cells[y][x];
          wrapper.appendChild(img);
          cell.appendChild(wrapper);
        }
      });
    }

    function getFlips(x, y, player) {
      const opponent = player === 'black' ? 'white' : 'black';
      const flips = [];
      const directions = [
        [1,0], [-1,0], [0,1], [0,-1],
        [1,1], [-1,-1], [1,-1], [-1,1]
      ];

      for (const [dx, dy] of directions) {
        let nx = x + dx, ny = y + dy;
        const temp = [];
        while (nx >= 0 && ny >= 0 && nx < 8 && ny < 8 && cells[ny][nx] === opponent) {
          temp.push([nx, ny]);
          nx += dx;
          ny += dy;
        }
        if (nx >= 0 && ny >= 0 && nx < 8 && ny < 8 && cells[ny][nx] === player && temp.length > 0) {
          flips.push(...temp);
        }
      }
      return flips;
    }

    function makeMove(x, y, player) {
      const flips = getFlips(x, y, player);
      if (cells[y][x] || flips.length === 0) return false;
      cells[y][x] = player;
      flips.forEach(([fx, fy]) => cells[fy][fx] = player);
      drawBoard();
      return true;
    }

    function getAllValidMoves(player) {
      const moves = [];
      for (let y = 0; y < 8; y++) {
        for (let x = 0; x < 8; x++) {
          if (!cells[y][x] && getFlips(x, y, player).length > 0) {
            moves.push([x, y]);
          }
        }
      }
      return moves;
    }

    function aiTurn() {
      const moves = getAllValidMoves(aiPlayer);
      if (moves.length === 0) return;
      const [x, y] = moves[Math.floor(Math.random() * moves.length)];
      makeMove(x, y, aiPlayer);
      currentPlayer = 'black';
      status.textContent = '玩家';
    }

    board.addEventListener('click', e => {
      const cell = e.target.closest('.cell');
      if (!cell) return;
      const x = +cell.dataset.x;
      const y = +cell.dataset.y;
      if (currentPlayer !== 'black') return;
      if (makeMove(x, y, currentPlayer)) {
        currentPlayer = 'white';
        status.textContent = 'AI';
        if (aiEnabled) setTimeout(aiTurn, 500);
      }
    });

    createBoard();
  </script>
</body>
</html>
